<?xml version="1.0" encoding="UTF-8"?>

<!-- =====================================================================
DpCatalogComponentAi.xml
Generated by fpp-to-xml
====================================================================== -->
<component namespace="Svc" name="DpCatalog" kind="active">

  <comment>
  A component for managing downlink of data products
  </comment>

  <import_enum_type>Fw/Types/WaitEnumAi.xml</import_enum_type>
  <import_enum_type>Svc/DpCatalog/DpHdrFieldEnumAi.xml</import_enum_type>
  <import_enum_type>Svc/FileDownlinkPorts/SendFileStatusEnumAi.xml</import_enum_type>
  <import_port_type>Fw/Cmd/CmdPortAi.xml</import_port_type>
  <import_port_type>Fw/Cmd/CmdRegPortAi.xml</import_port_type>
  <import_port_type>Fw/Cmd/CmdResponsePortAi.xml</import_port_type>
  <import_port_type>Fw/Log/LogPortAi.xml</import_port_type>
  <import_port_type>Fw/Log/LogTextPortAi.xml</import_port_type>
  <import_port_type>Fw/Time/TimePortAi.xml</import_port_type>
  <import_port_type>Fw/Tlm/TlmPortAi.xml</import_port_type>
  <import_port_type>Svc/FileDownlinkPorts/SendFileCompletePortAi.xml</import_port_type>
  <import_port_type>Svc/FileDownlinkPorts/SendFileRequestPortAi.xml</import_port_type>
  <import_port_type>Svc/Ping/PingPortAi.xml</import_port_type>
  <import_serializable_type>Svc/DpCatalog/DpRecordSerializableAi.xml</import_serializable_type>

  <ports>
    <port name="CmdDisp" data_type="Fw::Cmd" kind="input" role="Cmd" max_number="1">
      <comment>
      Command receive port
      </comment>
    </port>
    <port name="CmdReg" data_type="Fw::CmdReg" kind="output" role="CmdRegistration" max_number="1">
      <comment>
      Command registration port
      </comment>
    </port>
    <port name="CmdStatus" data_type="Fw::CmdResponse" kind="output" role="CmdResponse" max_number="1">
      <comment>
      Command response port
      </comment>
    </port>
    <port name="Log" data_type="Fw::Log" kind="output" role="LogEvent" max_number="1">
      <comment>
      Event port
      </comment>
    </port>
    <port name="LogText" data_type="Fw::LogText" kind="output" role="LogTextEvent" max_number="1">
      <comment>
      Text event port
      </comment>
    </port>
    <port name="Time" data_type="Fw::Time" kind="output" role="TimeGet" max_number="1">
      <comment>
      Time get port
      </comment>
    </port>
    <port name="Tlm" data_type="Fw::Tlm" kind="output" role="Telemetry" max_number="1">
      <comment>
      Telemetry port
      </comment>
    </port>
    <port name="fileDone" data_type="Svc::SendFileComplete" kind="async_input" max_number="1" full="assert">
      <comment>
      File Downlink send complete port
      </comment>
    </port>
    <port name="fileOut" data_type="Svc::SendFileRequest" kind="output" max_number="1">
      <comment>
      File Downlink send port
      </comment>
    </port>
    <port name="pingIn" data_type="Svc::Ping" kind="async_input" max_number="1" full="assert">
      <comment>
      Ping input port
      </comment>
    </port>
    <port name="pingOut" data_type="Svc::Ping" kind="output" max_number="1">
      <comment>
      Ping output port
      </comment>
    </port>
  </ports>

  <commands>
    <command kind="async" opcode="0x0" mnemonic="BUILD_CATALOG" full="assert">
      <comment>
      Build catalog from data product directory. Will block until complete
      </comment>
    </command>
    <command kind="async" opcode="0x1" mnemonic="START_XMIT_CATALOG" full="assert">
      <comment>
      Start transmitting catalog
      </comment>
      <args>
        <arg name="wait" type="Fw::Wait">
          <comment>
          have START_XMIT command complete wait for catalog to complete transmitting
          </comment>
        </arg>
      </args>
    </command>
    <command kind="async" opcode="0x2" mnemonic="STOP_XMIT_CATALOG" full="assert">
      <comment>
      Stop transmitting catalog
      </comment>
    </command>
    <command kind="async" opcode="0x3" mnemonic="CLEAR_CATALOG" full="assert">
      <comment>
      clear existing catalog
      </comment>
    </command>
  </commands>

  <events>
    <event id="0x0" name="DirectoryOpenError" severity="WARNING_HI" format_string="Unable to process directory %s status %d">
      <comment>
      Error opening directory
      </comment>
      <args>
        <arg name="loc" type="string" size="80">
          <comment>
          The directory
          </comment>
        </arg>
        <arg name="stat" type="I32">
          <comment>
          status
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x1" name="ProcessingDirectory" severity="ACTIVITY_LO" format_string="Processing directory %s">
      <comment>
      Processing directory
      </comment>
      <args>
        <arg name="directory" type="string" size="80">
          <comment>
          The directory
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x2" name="ProcessingFile" severity="ACTIVITY_LO" format_string="Processing file %s">
      <comment>
      Processing directory
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x3" name="ProcessingDirectoryComplete" severity="ACTIVITY_HI" format_string="Completed processing directory %s. Total products: %u Pending products: %u Pending bytes: %lu">
      <comment>
      Directory Processing complete
      </comment>
      <args>
        <arg name="loc" type="string" size="80">
          <comment>
          The directory
          </comment>
        </arg>
        <arg name="total" type="U32">
          <comment>
          total data products
          </comment>
        </arg>
        <arg name="pending" type="U32">
          <comment>
          pending data products
          </comment>
        </arg>
        <arg name="pending_bytes" type="U64">
          <comment>
          pending data product volume
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x4" name="CatalogBuildComplete" severity="ACTIVITY_HI" format_string="Catalog build complete">
      <comment>
      Catalog processing complete
      </comment>
    </event>
    <event id="0xA" name="CatalogXmitStarted" severity="ACTIVITY_HI" format_string="Catalog transmission started">
      <comment>
      Catalog transmission started
      </comment>
    </event>
    <event id="0xB" name="CatalogXmitStopped" severity="ACTIVITY_HI" format_string="Catalog transmission stopped. %u bytes transmitted.">
      <comment>
      Catalog transmission stopped
      </comment>
      <args>
        <arg name="bytes" type="U32">
          <comment>
          data transmitted
          </comment>
        </arg>
      </args>
    </event>
    <event id="0xC" name="CatalogXmitCompleted" severity="ACTIVITY_HI" format_string="Catalog transmission completed.  %lu bytes transmitted.">
      <comment>
      Catalog transmission completed
      </comment>
      <args>
        <arg name="bytes" type="U64">
          <comment>
          data transmitted
          </comment>
        </arg>
      </args>
    </event>
    <event id="0xD" name="SendingProduct" severity="ACTIVITY_LO" format_string="Sending product %s of size %u priority %u">
      <comment>
      Sending product
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="bytes" type="U32">
          <comment>
          file size
          </comment>
        </arg>
        <arg name="prio" type="U32">
          <comment>
          DP priority
          </comment>
        </arg>
      </args>
    </event>
    <event id="0xE" name="ProductComplete" severity="ACTIVITY_LO" format_string="Product %s complete">
      <comment>
      Product send complete
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x14" name="ComponentNotInitialized" severity="WARNING_HI" format_string="DpCatalog not initialized!" throttle="10">
      <comment>
      Component not initialized error
      </comment>
    </event>
    <event id="0x15" name="ComponentNoMemory" severity="WARNING_HI" format_string="DpCatalog couldn&apos;t get memory" throttle="10">
      <comment>
      Component didn&apos;t get memory error
      </comment>
    </event>
    <event id="0x16" name="CatalogFull" severity="WARNING_HI" format_string="DpCatalog full during directory %s" throttle="10">
      <comment>
      Catalog is full
      </comment>
      <args>
        <arg name="dir" type="string" size="80">
          <comment>
          last directory read
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x17" name="FileOpenError" severity="WARNING_HI" format_string="Unable to open DP file %s status %d" throttle="10">
      <comment>
      Error opening file
      </comment>
      <args>
        <arg name="loc" type="string" size="80">
          <comment>
          The directory
          </comment>
        </arg>
        <arg name="stat" type="I32">
          <comment>
          status
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x18" name="FileReadError" severity="WARNING_HI" format_string="Error reading DP file %s status %d" throttle="10">
      <comment>
      Error opening file
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="I32">
          <comment>
          status
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x19" name="FileHdrError" severity="WARNING_HI" format_string="Error reading DP %s header %s field. Expected: %u Actual: %u" throttle="10">
      <comment>
      Error reading header data from DP file
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="field" type="Svc::DpHdrField">
          <comment>
          incorrect value
          </comment>
        </arg>
        <arg name="exp" type="U32">
          <comment>
          expected value
          </comment>
        </arg>
        <arg name="act" type="U32">
          <comment>
          expected value
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x1A" name="FileHdrDesError" severity="WARNING_HI" format_string="Error deserializing DP %s header stat: %d" throttle="10">
      <comment>
      Error deserializing header data
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="I32"/>
      </args>
    </event>
    <event id="0x1B" name="DpInsertError" severity="WARNING_HI" format_string="Error deserializing DP %s" throttle="10">
      <comment>
      Error inserting entry into list
      </comment>
      <args>
        <arg name="dp" type="Svc::DpRecord">
          <comment>
          The DP
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x1C" name="DpDuplicate" severity="DIAGNOSTIC" format_string="DP %s already in catalog" throttle="10">
      <comment>
      Error inserting entry into list
      </comment>
      <args>
        <arg name="dp" type="Svc::DpRecord">
          <comment>
          The DP
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x1D" name="DpCatalogFull" severity="WARNING_HI" format_string="Catalog full trying to insert DP %s" throttle="10">
      <comment>
      Error inserting entry into list
      </comment>
      <args>
        <arg name="dp" type="Svc::DpRecord">
          <comment>
          The DP
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x1E" name="DpXmitInProgress" severity="WARNING_LO" format_string="Cannot build new catalog while DPs are being transmitted" throttle="10">
      <comment>
      Tried to build catalog while downlink process active
      </comment>
    </event>
    <event id="0x1F" name="FileSizeError" severity="WARNING_HI" format_string="Error getting file %s size. stat: %d" throttle="10">
      <comment>
      Error getting file size
      </comment>
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="I32"/>
      </args>
    </event>
    <event id="0x20" name="NoDpMemory" severity="WARNING_HI" format_string="No memory for DP"/>
    <event id="0x21" name="NotInitialized" severity="WARNING_HI" format_string="DpCatalog not initialized"/>
    <event id="0x22" name="XmitNotActive" severity="WARNING_LO" format_string="DpCatalog transmit not active"/>
    <event id="0x23" name="StateFileOpenError" severity="WARNING_HI" format_string="Error opening state file %s, stat: %d">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="I32"/>
      </args>
    </event>
    <event id="0x24" name="StateFileReadError" severity="WARNING_HI" format_string="Error reading state file %s, stat %d, offset: %d">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="I32"/>
        <arg name="offset" type="I32"/>
      </args>
    </event>
    <event id="0x25" name="StateFileTruncated" severity="WARNING_HI" format_string="Truncated state file %s size. offset: %d size: %d">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="offset" type="I32"/>
        <arg name="size" type="I32"/>
      </args>
    </event>
    <event id="0x26" name="NoStateFileSpecified" severity="WARNING_LO" format_string="No specified state file"/>
    <event id="0x27" name="StateFileWriteError" severity="WARNING_HI" format_string="Error writing state file %s, stat %d">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="I32"/>
      </args>
    </event>
    <event id="0x28" name="NoStateFile" severity="WARNING_LO" format_string="State file %s doesn&apos;t exist">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
      </args>
    </event>
    <event id="0x29" name="DpFileXmitError" severity="WARNING_HI" format_string="Error transmitting DP file %s, stat %s. Halting xmit." throttle="10">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="Svc::SendFileStatus"/>
      </args>
    </event>
    <event id="0x2A" name="DpFileSendError" severity="WARNING_HI" format_string="Error sending DP file %s, stat %s. Halting xmit." throttle="10">
      <args>
        <arg name="file" type="string" size="80">
          <comment>
          The file
          </comment>
        </arg>
        <arg name="stat" type="Svc::SendFileStatus"/>
      </args>
    </event>
  </events>

  <telemetry>
    <channel id="0x0" name="CatalogDps" data_type="U32" update="always">
      <comment>
      Number of data products in catalog
      </comment>
    </channel>
    <channel id="0x1" name="DpsSent" data_type="U32" update="always">
      <comment>
      Number of data products sent
      </comment>
    </channel>
  </telemetry>

</component>
